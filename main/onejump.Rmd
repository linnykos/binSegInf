---
title: 'One-jump simulations'
author: "Binseginf"
date: "Oct 13th, 2016"
---


Objective
========================
- From one-jump generated data, make QQ plots of conditional power (no stopping rule)

Simulation
========================
Generate data from:
$$ n = 12 $$ 
$$ y \in \mathbb{R}^n $$
$$ \theta = (\underbrace{0,\cdots,0}_{n/2},\underbrace{\delta,\cdots,\delta}
   )^n \in \mathbb{R}^n $$
We will consider signal size $\delta = 0,1,2,3,4$.


Basic sanity checks:
=========================
All $Gy \ge 0$
```{r,include=}
library(binSegInf)

## Simulation settings
n = 12
numsteps = n - 1
nsim = 100
sigma = 0.5

## Confirm p-values
p = rep(NA,nsim)
for(isim in 1:nsim){
    y = rnorm(n,0,sigma)
    a = binSegInf:::binseg.by.size(y, numsteps, verbose=FALSE)
    stopifnot(all(a$G%*%y>0))
}
```


QQ-plots of p-values
===
```{r,include=FALSE}
library(knitr) # We need the knitr package to set chunk options
library(parallel)
library(RColorBrewer)
options(mc.cores=2L)

# Set default knitr options for knitting code into the report:
opts_chunk$set(echo=TRUE,  # change to FALSE to keep code out of the knitted document
               cache=TRUE, # do not re-run code that has already been run
               autodep=TRUE, # assure that caching dependencies are updated correctly
               cache.comments=FALSE, # do not re-run a chunk if only comments are changed
               message=FALSE, # change to FALSE to keep messages out of the knitted document
               warning=TRUE  # change to FALSE to keep warnings out of the knitted document
               )
do.one.sim(1,1,1,1)
## Simulation settings
deltas = c(0,1,2,3)
nsims = c(12000,  3500,  1500,  1000)/100
sims= mcmapply(function(delta,nsim){ do.one.sim(delta,nsim,sigma=1,numsteps=1)}, deltas, nsims)
```


```{r}
## Make plot
pcols = brewer.pal(length(sims),"Set3")
make.qqplot.background()
Map(function(p,col){ make.qq.line(p,16,col)},
    sims,
    pcols)
make.qqplot.legend(deltas,16,pcols)

```